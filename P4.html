<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blackjack Game</title>
    <style>
        .card {
            width: 50px;
            height: 80px;
            display: inline-block;
            text-align: center;
            margin: 5px;
        }
        .button {
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h2>Blackjack Game</h2>
    <div id="dealer">
        <h3>Dealer's Cards:</h3>
        <div id="dealerCards"></div>
        <p>Total: <span id="dealerTotal">0</span></p>
    </div>
    <div id="player">
        <h3>Player's Cards:</h3>
        <div id="playerCards"></div>
        <p>Total: <span id="playerTotal">0</span></p>
    </div>
    <div class="button">
        <button onclick="deal()">Deal</button>
        <button onclick="hit()" disabled>Hit</button>
        <button onclick="stand()" disabled>Stand</button>
    </div>

    <script>
        let deck = [];
        let playerCards = [];
        let dealerCards = [];
        let playerTotal = 0;
        let dealerTotal = 0;

        function createDeck() {
            const suits = ['c', 'd', 'h', 's'];
            const values = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'j', 'q', 'k', 'a']; // Note: All values are lowercase
            deck = [];
            for (let suit of suits) {
                for (let value of values) {
                    deck.push({ value, suit });
                }
            }
            deck = deck.sort(() => Math.random() - 0.5);
        }

        function getCardValue(card) {
            let value = card.value.toLowerCase(); // Ensure it is lowercase to match 'j', 'q', 'k', 'a'
            if (value === 'j' || value === 'q' || value === 'k') {
                return 10;
            }
            if (value === 'a') {
                return 11; // Initially assign Ace a value of 11
            }
            return parseInt(value);
        }

        function deal() {
            createDeck();
            playerCards = [deck.pop(), deck.pop()];
            dealerCards = [deck.pop(), deck.pop()];
            updateTotals();
            document.querySelector("button[onclick='hit()']").disabled = false;
            document.querySelector("button[onclick='stand()']").disabled = false;
        }

        function hit() {
            playerCards.push(deck.pop());
            updateTotals();
            if (playerTotal > 21) endGame("Player busts! Dealer wins.");
        }

        function stand() {
            while (dealerTotal < 17) {
                dealerCards.push(deck.pop());
                updateTotals();
            }
            if (dealerTotal > 21) endGame("Dealer busts! Player wins.");
            else if (playerTotal > dealerTotal) endGame("Player wins!");
            else if (playerTotal < dealerTotal) endGame("Dealer wins!");
            else endGame("It's a tie!");
        }

        function updateTotals() {
            playerTotal = calculateTotal(playerCards);
            dealerTotal = calculateTotal(dealerCards);
            displayCards();
        }

        function calculateTotal(cards) {
            let total = 0;
            let aces = 0;
            for (let card of cards) {
                let cardValue = getCardValue(card);
                total += cardValue;

                // Count the number of Aces
                if (card.value.toLowerCase() === 'a') {
                    aces += 1;
                }
            }

            // Adjust Aces if total exceeds 21
            while (total > 21 && aces > 0) {
                total -= 10;
                aces -= 1;
            }

            return total;
        }

        function displayCards() {
            const cardPath = './cards/';
            document.getElementById("playerCards").innerHTML = playerCards.map(card => `<img class="card" src="${cardPath + card.value + card.suit}.png" alt="${card.value}${card.suit}">`).join('');
            document.getElementById("dealerCards").innerHTML = dealerCards.map((card, index) => index === 0 ? `<img class="card" src="${cardPath + card.value + card.suit}.png" alt="${card.value}${card.suit}">` : `<img class="card" src="${cardPath}back.png" alt="back">`).join('');
            document.getElementById("playerTotal").innerText = playerTotal;
            document.getElementById("dealerTotal").innerText = dealerCards.length > 1 ? dealerTotal : getCardValue(dealerCards[0]);
        }

        function endGame(message) {
            alert(message);
            document.querySelector("button[onclick='hit()']").disabled = true;
            document.querySelector("button[onclick='stand()']").disabled = true;
        }
    </script>
</body>
</html>
